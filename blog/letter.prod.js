async function checkUser(e){let t=0;return await axios.post("/letter/checkUser",{name:e}).then(e=>{t=e.data.code}),t}async function verify(e){let t=!1;return await swal({text:"请输入密码（可联系博主）: ",content:"input",button:{text:"验证",closeModal:!1}}).then(t=>{if(!t)throw null;return axios.post("/letter/verify",{verify:t,name:e})}).then(e=>{let a={buttons:!1,icon:"success",timer:500};200==e.data.code?t=!0:a.icon="error",swal(a)}).catch(e=>{e?swal({title:e,icon:"error"}):(swal.stopLoading(),swal.close())}),t}function search(e){axios.get(`/letter/searchByName?addressee=${e}`).then(t=>{envelope=t.data.list.filter(t=>e==t.addressee),total=envelope.length,total>0?($(".envelope-container .number").text(total),$(".post:last-child").text(`有${total}封信，快打开看看吧`),$(".envelope-container").addClass("in"),initLetter(total,envelope),showLetterTo(1,envelope)):($(".envelope-container").removeClass("in"),$(".post:last-child").text("Σσ(・Д・；)好...好像还没有，先去别处逛逛吧"))}).catch(function(e){console.log(e)})}function initLetter(e=0){if(0!==e)for(let t=0;t<e;t++)$("<li>",{"data-target":t+1,class:0==t?"pages__item pages__item--1 page__item-active":"pages__item pages__item--"+(t+1),click:function(){if(event.stopPropagation(),animation)return;let e=+$(this).attr("data-target");pagination(curSlide,e),curSlide=e}}).appendTo(".pages__list")}function showLetterTo(e=1,t,a){let l=Number(e);a?($(".l-slide").removeClass("slideDownT"),$(".l-slide").removeClass("slideUpT"),$(".l-slide").addClass("slideUpF"),setTimeout(()=>{l>total&&(l=total);let e=t[l-1];$(".l-addressee").text("To ："+e.addressee),$(".l-title").text(e.title),$(".l-content").html(e.content),$(".l-date").text(e.date),$(".l-slide").removeClass("slideUpF"),$(".l-slide").addClass("slideDownT")},500)):($(".l-slide").removeClass("slideDownT"),$(".l-slide").removeClass("slideUpT"),$(".l-slide").addClass("slideDownF"),setTimeout(()=>{l>total&&(l=total);let e=t[l-1];$(".l-addressee").text("To ："+e.addressee),$(".l-title").text(e.title),$(".l-content").html(e.content),$(".l-date").text(e.date),$(".l-slide").removeClass("slideDownF"),$(".l-slide").addClass("slideUpT")},500))}function throttle(e,t){let a=0;return function(){let l=Date.now(),n=this,o=arguments;l-a>t&&(e.apply(n,o),a=l)}}function pagination(e,t){e!=t&&(animation=!0,nextSlide=void 0===t?scrolledUp?e-1:e+1:t,$(".pages__item--"+nextSlide).addClass("page__item-active"),$(".pages__item--"+e).removeClass("page__item-active"),nextSlide>e&&showLetterTo(nextSlide,envelope,!1),nextSlide<e&&showLetterTo(nextSlide,envelope,!0),setTimeout(()=>{animation=!1},500))}function navigateDown(){curSlide>total-1||(scrolledUp=!1,pagination(curSlide),curSlide++)}function navigateUp(){1!==curSlide&&(scrolledUp=!0,pagination(curSlide),curSlide--)}let scrolledUp,nextSlide,startX,startY,moveEndX,moveEndY,X,Y,animation=!1,total=0,curSlide=1,envelope=[],mailbox=[];$("#envelope-search").keyup(async e=>{if($(".pages__list").empty(),$(".envelope-container").removeClass("in"),total=0,curSlide=1,13!==e.keyCode)return;let t=e.target.value,a=await checkUser(t);if(212!==a){if(200===a){let a=await verify(t);a&&search(e.target.value)}210===a&&search(e.target.value)}else $(".post:last-child").text("Σσ(・Д・；)好...好像还没有，先去别处逛逛吧")}),$("#envelope-search").bind("input propertychange",function(e){e.target.value?$(".post:last-child").text("(σﾟ∀ﾟ)σ...轻按回车键查找"):$(".post:last-child").text("来找下有没有博主留给你的信吧")}),$(".overlay").on("click",throttle(function(){$("input#switch-on").prop("checked",!1)},500)),$(".letter").on("click",()=>{event.stopPropagation()}),$(".overlay").on("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent.wheelDelta;animation||(t>0||e.originalEvent.detail<0?navigateUp():navigateDown())}),$(".overlay").on("touchstart",function(e){e.cancelable&&(e.defaultPrevented||e.preventDefault()),startX=e.originalEvent.changedTouches[0].pageX,startY=e.originalEvent.changedTouches[0].pageY}),$(".overlay").on("touchend",function(e){e.cancelable&&(e.defaultPrevented||e.preventDefault()),moveEndX=e.originalEvent.changedTouches[0].pageX,moveEndY=e.originalEvent.changedTouches[0].pageY,X=moveEndX-startX,Y=moveEndY-startY,Y>0?navigateUp():Y<0?navigateDown():$("input#switch-on").prop("checked",!1)});